<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Littlehui&#39;s Notes</title>
  
  <subtitle>天地那么大，世界那么辽阔。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.lilhui.com/"/>
  <updated>2021-05-10T16:23:45.373Z</updated>
  <id>http://www.lilhui.com/</id>
  
  <author>
    <name>Littlehui</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【Mysql深入理解系列7】MVCC与BufferPool缓存机制</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_7/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_7/</id>
    <published>2021-05-10T16:22:39.000Z</published>
    <updated>2021-05-10T16:23:45.373Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MVCC与BufferPool"><a href="#MVCC与BufferPool" class="headerlink" title="MVCC与BufferPool"></a>MVCC与BufferPool</h2><ol><li>Undo 日志版本链与ReadView机制详解。</li><li>MVCC多版本并发控制详解。</li><li>Innodb引擎BufferPoll缓存机制详解。</li><li>Redo与Undo日志详解。</li></ol><h2 id="MVCC多版本并发控制机制"><a href="#MVCC多版本并发控制机制" class="headerlink" title="MVCC多版本并发控制机制"></a>MVCC多版本并发控制机制</h2><ul><li><p>Undo日志版本链</p><p>事务开始时候会生成一个Undo日志。包括数据值，事务ID。<br>Redview活跃的事务列表。</p></li></ul><p>ReadView 可见，不可见</p><p><img src="http://images.lilhui.com/594f8a7c21a2fb8500ab6bf155f8e190" alt="图片"></p><p>在可重复读隔离级别，当事务开启，执行任何查询sql时会生成当前事务的一致性视图read-view，该视图在事务结束之前都不会变化(如果是读已提交隔离级别在每次执行查询sql时都会重新生成)，这个视图由执行查询时所有未提交事务id数组（数组里最小的id为min_id）和已创建的最大事务id（max_id）组成，事务里的任何sql查询结果需要从对应版本链里的最新数据开始逐条跟read-view做比对从而得到最终的快照结果。</p><p>Mysql会将Undo链分成三个集合</p><p>已提交事务，未提交与已提交事务，未开始事务。</p><p><img src="http://images.lilhui.com/53f7864bd44cbd2bf09196927571ea6a" alt="图片"></p><h3 id="版本链对比规则"><a href="#版本链对比规则" class="headerlink" title="版本链对比规则"></a>版本链对比规则</h3><ol><li>如果 row 的 trx_id 落在绿色部分( trx_id<min_id )，表示这个版本是已提交的事务生成的，这个数据是可见的。="" 如果="" row="" 的="" trx_id="" 落在红色部分(="">max_id )，表示这个版本是由将来启动的事务生成的，是不可见的(若row 的 trx_id 就是当前自己的事务是可见的）。</min_id></li><li>如果 row 的 trx_id 落在黄色部分(min_id &lt;=trx_id&lt;= max_id)，那就包括两种情况：<br>a. 若 row 的 trx_id 在视图数组中，表示这个版本是由还没提交的事务生成的，不可见(若 row 的 trx_id 就是当前自己的事务是可见的)；<br>b. 若 row 的 trx_id 不在视图数组中，表示这个版本是已经提交了的事务生成的，可见。</li></ol><h3 id="Innodb引擎BufferPool"><a href="#Innodb引擎BufferPool" class="headerlink" title="Innodb引擎BufferPool"></a>Innodb引擎BufferPool</h3><h4 id="Redo与Undo"><a href="#Redo与Undo" class="headerlink" title="Redo与Undo"></a>Redo与Undo</h4><p>BufferPool是Innodb中的一块内存，缓存池。用于更新日志时缓存数据。</p><p><img src="http://images.lilhui.com/d2cca03ebe91a9727cd5bf1223a4f2e7" alt="图片"></p><p>update数据过程。</p><ol><li>加载叶子节点到innodb引擎中。 bufferPool</li><li>写undo日志</li><li>更新缓存日志。</li><li>写redo日志</li><li>准备提交事务，redo日志写入磁盘。（commit)</li><li>准备提交事务，写binlog。所有存储引擎都有些binlog日志的操作。</li><li>写一个commit标记到redo日志。为了redo与binlog数据一致。</li><li>随机写入磁盘以page为单位写入。</li></ol><p>当bufferPool丢失，redo日志可以用来还原。</p><p>BufferPool非常重要，整个mysql的增删改查都先进过BufferPool。为什么这么设计？提高效率。基于内存效率更高。</p><p>BufferPool过程中会进行undo和redo的读写。这样效率高吗？</p><p>undo,redo是顺序写。数据库是随机写。顺序效率&gt;随机 (2倍以上性能)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;MVCC与BufferPool&quot;&gt;&lt;a href=&quot;#MVCC与BufferPool&quot; class=&quot;headerlink&quot; title=&quot;MVCC与BufferPool&quot;&gt;&lt;/a&gt;MVCC与BufferPool&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Undo 日志版本链与R
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="MVCC" scheme="http://www.lilhui.com/tags/MVCC/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列6】事务隔离级别</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_6/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_6/</id>
    <published>2021-05-10T16:21:35.000Z</published>
    <updated>2021-05-10T16:22:29.776Z</updated>
    
    <content type="html"><![CDATA[<h2 id="事务隔离级别深入理解"><a href="#事务隔离级别深入理解" class="headerlink" title="事务隔离级别深入理解"></a>事务隔离级别深入理解</h2><ol><li>Mysql事务级ACID特性详解</li><li>Mysql事务隔离级别详解</li><li>Mysql锁机制详解</li><li>Mysql锁优化建议</li></ol><h2 id="事务隔离级别ACID"><a href="#事务隔离级别ACID" class="headerlink" title="事务隔离级别ACID"></a>事务隔离级别ACID</h2><h3 id="事务及其ACID属性。"><a href="#事务及其ACID属性。" class="headerlink" title="事务及其ACID属性。"></a>事务及其ACID属性。</h3><p>事务的特性 ACID:</p><p>ACID是原子性，一致性，持久性，独立性的缩写。</p><p>原子性：一个操作不是成功就是失败，要么执行成功，要么执行失败。</p><p>一致性：事务的索引规则，约束等不受破坏。事务开始中，所有相关的数据结果都必须保持状态一致，比如一个事务对三个数据进行修改，事务结束后三个状态必须都是被修改过的，保持一致。</p><p>隔离性： 每个事务之间不要相互影响。A事务查的结果不要被别的影响。就是说A事务执行过程中，结果集不能变。</p><p>持久性：事务完成后的对结果产生影响要持久。不能一会儿变来变去。</p><h3 id="并发事务带来的问题"><a href="#并发事务带来的问题" class="headerlink" title="并发事务带来的问题"></a>并发事务带来的问题</h3><ol><li>更新丢失(脏写)</li></ol><p>事务A对数据进行+1，事务B对数据进行-1。B的更新操作把A覆盖掉了。</p><ol><li>脏读</li></ol><p>事务A读取了事务B还未提交的数据，但是事务B进行了回滚。事务A读到了脏数据。</p><ol><li>不可重复读</li></ol><p>事务A读取了数据1，但是被B修改成了2，事务A再读变成了2。与之前的不同。</p><ol><li>幻影读</li></ol><p>事务A，count了一个数据块，事务B插入了一条数据，事务A再进行count的 时候数据变了。</p><p>以上问题都是事务隔离性问题。所以要引入事务隔离级别来解决这些问题。</p><h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h2><p><img src="http://images.lilhui.com/0368e43298acb164abd6e8d86ede311a" alt="图片"></p><p>事务隔离级别是Mysql提供的预设的几种级别。</p><ol><li>未提交读：事务T在读取数据的时候并未对数据进行加锁，事务T在修改数据的时候对数据增加行级共享锁，这种隔离级别没解决脏读。</li><li>已提交读：事务T在读取数据时增加行级共享锁，读取一旦结束，立即释放；事务T在修改数据时增加行级排它锁，直到事务结束才释放，这种隔离级别解决了脏读。</li><li>可重复读：事务T在数据读取时，必须增加行级共享锁，直到事务结束；事务T在修改数据过程中，必须增加行级排它锁，直到数据结束；这种隔离级别没解决幻读。</li><li>序列化：事务T在读取数据时，必须先增加表级共享锁，直到事务结束时才释放；事务T在修改数据时，必须先增加表级排它锁，直到事务结束才释放。</li></ol><p>这些隔离级别采用的是<br>MVCC:multi version concurrency controller</p><h2 id="锁机制详解"><a href="#锁机制详解" class="headerlink" title="锁机制详解"></a>锁机制详解</h2><p>锁机制是事务隔离级别的实现方式</p><h3 id="锁分类"><a href="#锁分类" class="headerlink" title="锁分类"></a>锁分类</h3><p>性能上分：悲观锁，乐观锁。<br>数据库操作上分：读锁，写锁。<br>从数据库的操作力度来分：表锁，行锁。</p><ul><li>表锁<br>开销小，加锁快。锁力度大， 一般在离线操作数据迁移的时候进行，比较少会用。</li><li>读锁（s)<br>可以进行共享读。</li><li>写锁（x)<br>不能进行写。也不能进行读。</li></ul><p>重点</p><ul><li>行锁<br>开销大，加锁慢。<br>innodb支持行锁。支持事务。</li><li>间隙锁<br>innodb采用间隙锁，在可重复读级别解决了幻读问题。</li><li>临键锁（next-ke）<br>行锁 + 间隙锁</li></ul><h2 id="锁优化建议"><a href="#锁优化建议" class="headerlink" title="锁优化建议"></a>锁优化建议</h2><h3 id="行锁分析"><a href="#行锁分析" class="headerlink" title="行锁分析"></a>行锁分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show status like &apos;innodb_row_locks&apos;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-- 查看事务</div><div class="line">select * from INFORMATION_SCHEMA_INNODB_TRX</div><div class="line"></div><div class="line">-- 查看锁</div><div class="line"></div><div class="line">select * from INFORMATION_SCHEMA_INNODB_LOCKS</div><div class="line"></div><div class="line">-- 查看锁等待</div><div class="line"></div><div class="line">select * from INFORMATION_SCHEMA_INNODB_LOCK_WAITS</div><div class="line"></div><div class="line">-- 释放锁。trx_mysql_thread_id可以从INNODB_TRX表里查看到</div><div class="line"></div><div class="line">kill trx_mysql_thread_id</div></pre></td></tr></table></figure><h3 id="锁优化建议-1"><a href="#锁优化建议-1" class="headerlink" title="锁优化建议"></a>锁优化建议</h3><ol><li>尽可能让所有数据检索都通过索引来完成，避免误索引锁升级为表锁。</li><li>合理设计索引，尽量缩小锁的范围。</li><li>尽可能减少检索条件范围，避免间隙锁。</li><li>尽量控制事务大小，减少锁定资源和时间长度，涉及事务加锁的sql尽量放在事务后执行。</li><li>尽可能低级别事务隔离。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;事务隔离级别深入理解&quot;&gt;&lt;a href=&quot;#事务隔离级别深入理解&quot; class=&quot;headerlink&quot; title=&quot;事务隔离级别深入理解&quot;&gt;&lt;/a&gt;事务隔离级别深入理解&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Mysql事务级ACID特性详解&lt;/li&gt;
&lt;li&gt;Mysql事
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="事务" scheme="http://www.lilhui.com/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列4】索引优化1</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_4/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_4/</id>
    <published>2021-05-10T16:19:33.000Z</published>
    <updated>2021-05-10T16:21:17.076Z</updated>
    
    <content type="html"><![CDATA[<h2 id="索引优化"><a href="#索引优化" class="headerlink" title="索引优化"></a>索引优化</h2><ol><li>详解</li><li>优化索引选择探究</li><li>索引优化Orderby与Group byy</li><li>UsingfileSort文件排序详解。</li><li>索引设计原则与实战。</li></ol><h2 id="索引优化原则"><a href="#索引优化原则" class="headerlink" title="索引优化原则"></a>索引优化原则</h2><p>避免ALL权标扫描。即时没走索引也要避免回表</p><p>扫描行数不决定查询快慢，还有回表啊什么的影响。大多情况下不用去改mysql的优化查询。（force dindex 不一定会更快)</p><p>PS:</p><ol><li>字符串不加单引号索引失效。<br>2.</li></ol><p>三个键的组合索引，范围查询放中间或者后面是可以走索引的。</p><p>1.</p><ol><li>强制走索引。扫描行数可能少了，但是执行时间并不一定减少。</li><li>覆盖索引优化。</li><li>in和or在表数量比较大的情况下回走索引，在表记录不多的情况下选择走权标扫描。</li><li><p>like kk%不管表数据量大小都会走索引。</p><p>概念：索引下推。like KK%就是用到了索引下推优化。</p></li></ol><p>索引下推5.6引入的。<br>索引下推查询：在二级索引树过滤完like的字段后会再过滤后面条件的内容。符合的话进行会标。所谓的索引下面在推断。<br>非下推（5.6之前）：在二级索引树过滤完like后没进行后面条件判断，直接回表，在回表的内容里在进行筛选。</p><p>索引下推意味着每次索引后，要再进行比对。like结果集少的话（like  xxx%)，比对就比较快。mysql会使用。如果数量非常大的话(column &gt; xxx)，每次都要比对，不一定比回表快。</p><p>使用 trace进行分析。列出explain sql执行的过程，mysql各个节点预估的消耗量。</p><h2 id="优化总结"><a href="#优化总结" class="headerlink" title="优化总结"></a>优化总结</h2><ol><li>mysql支持两种方式的排序filesort 和index, Using Index是指Mysql扫描索引本身完成排序，index效率高，filesort效率低。</li><li>order by 满足两种情况会使用Using index<ol><li>order by语句使用索引最左前列。</li><li>使用where子句与order by子句条件组合满足索引最左前列。</li></ol></li><li>尽量在索引列上完成排序，遵循索引建立的最左前缀法则。</li><li>如果 order by的条件不在索引列上，就会产生Using filesort</li><li>能用覆盖索引尽量用覆盖索引。</li><li>group by 与order by很类似。其实质是先排序后分组，遵照索引创建顺序的最左前缀法则。对group by的优化如果不需要排序的可以加上order by null禁止排序。注意，where高于having,能卸载where先定条件就不要去having限定。</li></ol><p>单路排序：<br>一次性取出满足条件行的所有字段，在sortbuffer中进行排序，用trace工具可以看到sort_mode信息显示。sort_key,additional_files或者 sort_key,packed_additional_fileds<br>不用回表。占用内存大。<br>双路排序：<br>根据条件取出相应的排序字段和可以直接定位行数据的ID,然后在sort buffer中进行爱旭。排序完后需要取回其他需要的字段、用trace工具可以看到sort_mode信息显示 sort_key,rowid。<br>需要回表，暂用内存小。</p><p>可设置max_length_for_sort_data默认1024 。如果参与排序的字段小于这个的话，使用单路排序。如果大于的话，会使用双路排序。一般不去设置。</p><p>sort_buffer 排序内存。如果它比较小的话可以适当把max_length_for_sort_data配置小点，让优化器选择双路排序。（双路排序用ID,不用tmpfile)</p><p>sort_buffer可以考虑配置更大的max_length_for_sort_data从而使用单路排序。</p><p>非DBA就不要去调整了。</p><h2 id="怎么建索引"><a href="#怎么建索引" class="headerlink" title="怎么建索引"></a>怎么建索引</h2><p>建完表后，一般主体的业务开发完后，把跟表相关的sql语句都拉出来。根据sql语句建索引。</p><p>原则：</p><ol><li>代码先行，主体业务完成后，建索引。</li><li>联合索引尽量覆盖到你业务的所有查询。order by group by这些都需要考虑。</li><li>不要在小基数字段上建立索引。</li><li>长字符串可以采用前缀索引。varchar(255) 建索引耗费太大的空间，可以 Key index（name(20),age,position)。前缀的一部分进行建索引</li><li>where 与order by冲突时优先where</li><li>基于慢sql查询进行建索引。slow_query_log=1</li></ol><p>（provice,city,sex,age)<br>age一般范围查询，放后面，在实际查询中，查询可以把 sex按照in塞进去，这样age就可以走索引。一般一个组合索引里保持只有一个范围查询的字段。<br><img src="http://images.lilhui.com/aa90f7ad0a50d0a3deda306e02928495" alt="图片"></p><p><img src="http://images.lilhui.com/ed89b7e3209bc61303bd845e73385d67" alt="图片"></p><p>经验：10个字段左右的表。一个表里建2-3个组合二级索引就差不多了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;索引优化&quot;&gt;&lt;a href=&quot;#索引优化&quot; class=&quot;headerlink&quot; title=&quot;索引优化&quot;&gt;&lt;/a&gt;索引优化&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;详解&lt;/li&gt;
&lt;li&gt;优化索引选择探究&lt;/li&gt;
&lt;li&gt;索引优化Orderby与Group byy&lt;/li&gt;
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="索引优化" scheme="http://www.lilhui.com/tags/%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列5】索引优化2</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_5/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_5/</id>
    <published>2021-05-10T16:19:33.000Z</published>
    <updated>2021-05-10T16:21:24.038Z</updated>
    
    <content type="html"><![CDATA[<ol><li>分页查询优化详解。</li><li>表JOIN关联原理以及优化。</li><li>表COUNT查询优化。</li><li>阿里巴巴MYSQL规范解读。</li><li>MYSQL数据类型选择分析。</li></ol><h2 id="分页查询优化"><a href="#分页查询优化" class="headerlink" title="分页查询优化"></a>分页查询优化</h2><p>一般的分页：<br>select * from employee limit 1,100</p><ul><li>优化方式：</li></ul><ol><li><p>根据自增连续主键排序的分页：<br>改成 id&gt;xxx limit 10;</p></li><li><p>用innerjoin来改写。<br>select <em> from employees order by name limit 90000,5可以改写成：<br>select </em> from employees e inner join(select id from employees order by name limit 90000,5) ed on e.id = ed.id</p></li></ol><h2 id="表JOIN关联"><a href="#表JOIN关联" class="headerlink" title="表JOIN关联"></a>表JOIN关联</h2><p>select * from t1 inner join t2 on t1.a = t2.a</p><p>在Mysql的实现中，Nested-Loop Join有3种实现的算法：</p><p>Simple Nested-Loop Join：SNLJ，简单嵌套循环连接<br>Index Nested-Loop Join：INLJ，索引嵌套循环连接<br>Block Nested-Loop Join：BNLJ，缓存块嵌套循环连接</p><ol><li><p>嵌套循环链接  Nested-LoopJoin</p></li><li><p>Simple Nested-Loop</p></li></ol><p>简单嵌套循环连接实际上就是简单粗暴的嵌套循环，如果table1有1万条数据，table2有1万条数据，那么数据比较的次数=1万 * 1万 =1亿次，这种查询效率会非常慢。</p><ol><li>Index Nested-Loop</li></ol><p>索引嵌套循环连接是基于索引进行连接的算法，索引是基于内层表的，通过外层表匹配条件直接与内层表索引进行匹配，避免和内层表的每条记录进行比较， 从而利用索引的查询减少了对内层表的匹配次数，优势极大的提升了 join的性能：</p><p>使用场景：只有内层表join的列有索引时，才能用到Index Nested-LoopJoin进行连接。<br>由于用到索引，如果索引是辅助索引而且返回的数据还包括内层表的其他数据，则会回内层表查询数据，多了一些IO操作。</p><p><img src="http://images.lilhui.com/0f2bfaffe86c00fb7e8c28bf07b0b22a" alt="图片"></p><ol><li>基于块的嵌套循环链接Block Nested-Loop Join算法<br>把驱动表的数据读入到join_buffer然后被驱动表扫描，与join_buffer的数据做对比。<br>极端条件下，会过滤 t1 数量 * t2 数量词。</li></ol><p>缓存块嵌套循环连接通过一次性缓存多条数据，把参与查询的列缓存到Join Buffer 里，然后拿join buffer里的数据批量与内层表的数据进行匹配，从而减少了内层循环的次数（遍历一次内层表就可以批量匹配一次Join Buffer里面的外层表数据）。</p><p>当不使用Index Nested-Loop Join的时候，默认使用Block Nested-Loop Join。</p><p><img src="http://images.lilhui.com/9a0f921f3deb3e7b727b293323d809ca" alt="图片"></p><p>什么是Join Buffer？<br>（1）Join Buffer会缓存所有参与查询的列而不是只有Join的列。<br>（2）可以通过调整join_buffer_size缓存大小<br>（3）join_buffer_size的默认值是256K，join_buffer_size的最大值在MySQL 5.1.22版本前是4G-1，而之后的版本才能在64位操作系统下申请大于4G的Join Buffer空间。<br>（4）使用Block Nested-Loop Join算法需要开启优化器管理配置的optimizer_switch的设置block_nested_loop为on，默认为开启。</p><ul><li>优化JOIN</li></ul><ol><li>用小结果集驱动大结果集，减少外层循环的数据量，从而减少内层循环次数：<br>如果小结果集和大结果集连接的列都是索引列，mysql在内连接时也会选择用小结果集驱动大结果集，因为索引查询的成本是比较固定的，这时候外层的循环越少，join的速度便越快。</li><li><p>为匹配的条件增加索引：争取使用INLJ，减少内层表的循环次数</p></li><li><p>增大join buffer size的大小：当使用BNLJ时，一次缓存的数据越多，那么内层表循环的次数就越少</p></li><li><p>减少不必要的字段查询：<br>（1）当用到BNLJ时，字段越少，join buffer 所缓存的数据就越多，内层表的循环次数就越少；<br>（2）当用到INLJ时，如果可以不回表查询，即利用到覆盖索引，则可能可以提示速度。（未经验证，只是一个推论</p></li></ol><h2 id="in和exsits优化"><a href="#in和exsits优化" class="headerlink" title="in和exsits优化"></a>in和exsits优化</h2><p>exists少用，能用join替代用join。<br>记住。小表驱动大表。</p><h2 id="表COUNT执行"><a href="#表COUNT执行" class="headerlink" title="表COUNT执行"></a>表COUNT执行</h2><p>5.7版本 count(1),count(id),count(*)一样，几乎不用管。</p><p>分析：count(1) 不取值按行累加。count(*)也一样。count(字段) 拿出值走二级索引。count(id)走聚簇索引。<br>聚簇索引一般比二级索引大，所以count(字段有索引)比count(id)效率大一点点。</p><ul><li>常见优化方法<br>维护表数据量。</li></ul><p>innodb为什么不维护全表数量。是因为MVCC。多版本数据控制。不同的事务count（*）可能不一样。</p><ol><li>count(*)</li></ol><p>2.<br>对总记录数没有特别精确可以用：</p><pre><code>show table status like &apos;employees&apos;;</code></pre><ol><li>redis维护。数据库缓存双写一致代价很高。</li><li>增加数据库计数表。</li></ol><h2 id="阿里巴巴Mysql规范手册解读"><a href="#阿里巴巴Mysql规范手册解读" class="headerlink" title="阿里巴巴Mysql规范手册解读"></a>阿里巴巴Mysql规范手册解读</h2><p>单标行不要超过500万行，或者单标容量超过2G，推荐分表。<br>如果预计三年后的数据量根本达不到这个级别，就不要在建表时就进行分表。</p><ul><li>索引规约</li></ul><ol><li>有唯一键字段，即使是组合字段，也要建成唯一字段。</li><li>超过三个表不能进行join.</li><li>在varchar上建立索引，必须指定索引长度。</li><li>页面搜索严禁使用做模糊或者全模糊。这种场景适合走搜索引擎。</li></ol><ul><li>数据类型选择</li></ul><p><img src="http://images.lilhui.com/8a29aa20c1f33d5b34044ff19706cf61" alt="图片"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;分页查询优化详解。&lt;/li&gt;
&lt;li&gt;表JOIN关联原理以及优化。&lt;/li&gt;
&lt;li&gt;表COUNT查询优化。&lt;/li&gt;
&lt;li&gt;阿里巴巴MYSQL规范解读。&lt;/li&gt;
&lt;li&gt;MYSQL数据类型选择分析。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;分页查询优化&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="索引" scheme="http://www.lilhui.com/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列3】执行原理</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_3/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_3/</id>
    <published>2021-05-10T16:14:20.000Z</published>
    <updated>2021-05-10T16:15:54.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="登录建立连接"><a href="#登录建立连接" class="headerlink" title="登录建立连接"></a>登录建立连接</h2><ol><li>登录维持session</li><li>建立连接，权限缓存<ul><li>权限缓存在链接里。不用每次查询都校验。效率高。</li></ul></li></ol><p>查看链接数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show processlist;</div></pre></td></tr></table></figure></p><p>my.conf</p><p>query_cache_type<br>一般不用。</p><p>查看缓存命中情况。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show status like &apos;%Qcache%&apos;&apos;</div></pre></td></tr></table></figure></p><p>为什么这种缓存是鸡肋？</p><p>缓存的时候会经常刷新，不适用热点业务。</p><p><img src="http://images.lilhui.com/28ffc030006c338903910a74f6106973" alt="图片"></p><h2 id="词法分析器"><a href="#词法分析器" class="headerlink" title="词法分析器"></a>词法分析器</h2><p>sql语句拆分成语法树。</p><p>语法树：结构化的存储。<br><img src="http://images.lilhui.com/52eb397078359404e10612797ab9fc85" alt="图片"></p><p>语法树拆分后的使用场景：<br>在分布式事务中 二阶段提交。<br>commit,rollback</p><ol><li>通过语法树会记录反向操作。在回滚的时候直接rollback。</li><li>补偿机制。构建补偿sql。进行回滚重放。<br>3.<h2 id="优化器"><a href="#优化器" class="headerlink" title="优化器"></a>优化器</h2></li></ol><p>条件查询，会判断哪种效率高用哪种，或者判断用哪种索引或者不用索引。</p><h2 id="执行器"><a href="#执行器" class="headerlink" title="执行器"></a>执行器</h2><p>调用响应的引擎执行操作。</p><h2 id="bin-log归档"><a href="#bin-log归档" class="headerlink" title="bin-log归档"></a>bin-log归档</h2><p>不小心删了库怎么找回来？</p><p>server层实现的 bin-log技术。</p><p>bin-log记录的逻辑语句的影响。</p><p>bin-log格式有三种statement，row，mixed</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">binlog-format=ROW</div><div class="line">sync-binlog=1</div></pre></td></tr></table></figure><p>statement:记录的是这条操作语句的逻辑， 产生结果的过程。<br>row: 记录这个语句影响那条记录之后的结果。<br>row: mixed两种都记录。</p><p>如果记录的是statement</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update * from xxx where h=xx or b=xxx</div></pre></td></tr></table></figure><p>优化器走的索引不一致，可能产生主从不一致。</p><p>所以最好bin-log用row</p><h2 id="bin-log恢复"><a href="#bin-log恢复" class="headerlink" title="bin-log恢复"></a>bin-log恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flush logs;</div></pre></td></tr></table></figure><p>重新开个bin-log文件进行记录。</p><p>恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqlbinlog --no-defaults /**/*/mysql-bin.00001 | mysql -uroot -p xxx</div></pre></td></tr></table></figure></p><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">--start-position</div><div class="line">--end-position</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;登录建立连接&quot;&gt;&lt;a href=&quot;#登录建立连接&quot; class=&quot;headerlink&quot; title=&quot;登录建立连接&quot;&gt;&lt;/a&gt;登录建立连接&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;登录维持session&lt;/li&gt;
&lt;li&gt;建立连接，权限缓存&lt;ul&gt;
&lt;li&gt;权限缓存在链接里。
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="执行原理" scheme="http://www.lilhui.com/tags/%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列2】执行计划</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_2/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_2/</id>
    <published>2021-05-10T16:13:11.000Z</published>
    <updated>2021-05-10T16:15:54.679Z</updated>
    
    <content type="html"><![CDATA[<h2 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h2><p>分析sql执行数据<br>explain</p><p>语法：<br>explain ${sql}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">explain extended select * from (select * from film where id = 1) tmp;</div><div class="line">show warnings;</div></pre></td></tr></table></figure><p>TYPE 类型：</p><ol><li><p>SYSTEM:查询的整张表只有1个 select （select 1 from)</p></li><li><p>const:查询的结果跟const有的比。select 1 from</p></li><li><p>eq_ref:使用的唯一索引，效率仅次于 const</p></li><li><p>ref:普通索引，可能查出多条。或者唯一索引的部分前缀。联合索引等。</p></li><li><p>range:索引查出了范围集。</p></li></ol><p>以上都是走索引。</p><p>优化的方向</p><ol><li><p>index:全索引扫描。尽量优化。</p></li><li><p>ALL:全聚簇索引扫描。</p></li></ol><p>索引选择有优化，有的全表扫描效率更高就不选择索引。</p><p>如果结果集二级索引和主键索引全包含的情况下：<br>有主键索引也有二级索引，会优先索引二级索引。主键索引比较大。</p><ul><li>key_len</li></ul><p>组合索引(联合索引)，说明用到了多长的索引。</p><p>key_len计算规则：</p><ol><li>字符串<br>char(n) :字节长短<br>varchar(n): 3n+2。 +2存储字符串长度。</li><li>数值类型<br>tinyint:1字节。<br>smallint:2字节。<br>int：4字节。<br>bigint: 8字节。</li><li>时间类型<br>date: 3字节<br>timestamp:4字节</li></ol><h2 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h2><ol><li>Using index说明<br>查询的结果集在索引里，不用回表。</li></ol><ul><li>覆盖索引<br>一种查找方式，结果集在一颗索引树里。不用回表。</li></ul><ol><li>Using where<br>使用了where但是没有被索引覆盖。</li><li>Using index condition<br>查询的列不完全被索引覆盖，where条件中是一个前导列的范围。</li><li>Using templrary,Using index<br>Using templrary 使用了临时表。</li></ol><p>查询语句有distint但是没有走索引的话，会在内存里建立临时表去重。如果有走索引的话，会在所以查询的时候直接进行distinc去重。变成</p><ol><li>Using fileSort</li></ol><p>查询里有order by。但是没有建立索引。<br>如果有建索引会变成 Using index。因为索引已经是排好序了。</p><p>将用外部排序二不是所以你排序，数据较小时从内存排序。否则需要在磁盘完成。</p><ol><li>select tables optimized away<br>有max,min查询。使用了索引。</li></ol><ul><li>like查询</li></ul><p>like ‘ts%’  会使用索引<br>like ‘%ts’  不会使用索引。但是可以优化成全覆盖索引</p><ul><li>原则：<br>少用or</li></ul><p>因为or一次就是扫描一次。or多次可能比全表扫还慢。</p><ul><li>范围查找优化</li></ul><p>select * from employee where age &gt; 10 and age &lt; 1000<br>可能不走索引，印为mysql判断后可能全表扫描会比较快。</p><h2 id="索引总结表"><a href="#索引总结表" class="headerlink" title="索引总结表"></a>索引总结表</h2><p><img src="http://images.lilhui.com/c6d412fcc1a203a0538fdd1c70c19c5a" alt="图片"></p><p>like kk%相当于=常量，%kk和%kk%相当于范围。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;执行计划&quot;&gt;&lt;a href=&quot;#执行计划&quot; class=&quot;headerlink&quot; title=&quot;执行计划&quot;&gt;&lt;/a&gt;执行计划&lt;/h2&gt;&lt;p&gt;分析sql执行数据&lt;br&gt;explain&lt;/p&gt;
&lt;p&gt;语法：&lt;br&gt;explain ${sql}&lt;/p&gt;
&lt;figure 
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="执行计划" scheme="http://www.lilhui.com/tags/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>【Mysql深入理解系列1】数据结构</title>
    <link href="http://www.lilhui.com/2021/05/11/mysql/mysql_deep_1/"/>
    <id>http://www.lilhui.com/2021/05/11/mysql/mysql_deep_1/</id>
    <published>2021-05-10T16:11:18.000Z</published>
    <updated>2021-05-10T16:13:35.459Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数据结构基础"><a href="#数据结构基础" class="headerlink" title="数据结构基础"></a>数据结构基础</h2><p><a href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html" target="_blank" rel="external">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a></p><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><ul><li><p>二叉树：可能产生单边链，对查询效率就很低。</p></li><li><p>红黑树：二插平衡树。 树的高度会很高。</p></li><li><p>B树：<br><img src="http://images.lilhui.com/d618d928c25644e37922e3e6175a156a" alt="图片"></p></li></ul><ol><li>非叶子节点也有存data。一个元素占用1K。一个NODE最大 16个元素。</li><li>所以数量大的话，树高度也会很高。</li></ol><p>PS：大概估计是1kb 总共能存16个元素</p><ul><li>B+树：<br>平衡，且树矮<br>索引的基本结构：B+树</li></ul><ol><li>非叶子节点不存储data，只存储所以。</li><li>叶子节点包含所有索引字段</li><li>叶子节点用指针连接。提高访问的性能。</li></ol><p><img src="http://images.lilhui.com/27e421c5da22e9d5b06447d5212dff64" alt="图片"></p><p>一个NODE(树的节点） 16K</p><p>按照页来分配，一个16K。<br>一次磁盘IO很慢，内存很快。所以比较费时间的是从磁盘node到NODE查询。</p><p>一个索引8B<br>一个地址6B</p><p>16KB可以放  16KB/(8+6)个元素1170</p><p>那么2层的B+tree<br>1170 * 1170 = 1368900</p><p>叶子节点有data一个NODE放16个元素。一个元素1K.<br>算上叶子节点 1170 <em> 1170 </em> 16<br>个元素。<br>大概2000多万。<br>树的高度3</p><p>所以只要3次IO。根节点常住内存。</p><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><h3 id="mysam"><a href="#mysam" class="headerlink" title="mysam"></a>mysam</h3><p><img src="http://images.lilhui.com/58d102c4891d5aad217c14d7187c0a70" alt="图片"></p><p>叶子节点存的数据地址。</p><h3 id="innodb"><a href="#innodb" class="headerlink" title="innodb"></a>innodb</h3><p><img src="http://images.lilhui.com/a3cabd170f1ab82feabb8dad5119086c" alt="图片"></p><p>叶子节点存的是具体的data值。</p><h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><h3 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h3><p>MyInSam<br>ID主键是非聚簇索引。</p><p>Inodb<br>ID主键是聚簇索引。</p><h2 id="关于主键"><a href="#关于主键" class="headerlink" title="关于主键"></a>关于主键</h2><ol><li><p>建立索引：<br>组织B+。如果没有索引的话，选择第一列所有元素都不相等的元素来组织。如果没找到，建立一个隐藏列。这个隐藏列是唯一ID 组织B+树。</p></li><li><p>整型ID的作用：<br>在建立索引和查询索引的过程中，会进行多次的比大小。Int效率高。如果是String的话必须每个字符都要对比。并且占用空间也小，节省固态硬盘，节省成本。</p></li><li><p>自增：<br>HASH索引下。很快可以对应到磁盘文件地址。<br><img src="http://images.lilhui.com/4ddc87ded96ce3bc73dc860621133b47" alt="图片"><br>优点：等值查询很快。<br>缺点：范围查询效率不好。并且会产生HAHD冲突。</p></li></ol><ol><li><p>聚簇索引和非聚簇索引那个快？<br>聚簇索引会比较快。</p></li><li><p>非主键索引：<br><img src="http://images.lilhui.com/7b45a9e7e7db9ddba1b4fea568e3401f" alt="图片"><br>非聚簇索引的叶子节点的数据放的是聚簇索引索引节点值。<br>PS：INODB只有一个聚簇索引。<br>为什么不直接放数据？节约存储空间，可以多存放非常多数据。</p></li></ol><h2 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h2><p>联合索引底层存储</p><ul><li>索引是帮助Mysql搞笑查询排好序的数据结构。</li></ul><p>联合索引也是排好序的数据结构。</p><p><img src="http://images.lilhui.com/ecea37f94b3fa604553ce6eb6c765788" alt="图片"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;数据结构基础&quot;&gt;&lt;a href=&quot;#数据结构基础&quot; class=&quot;headerlink&quot; title=&quot;数据结构基础&quot;&gt;&lt;/a&gt;数据结构基础&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.cs.usfca.edu/~galles/visualizatio
      
    
    </summary>
    
      <category term="mysql" scheme="http://www.lilhui.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://www.lilhui.com/tags/mysql/"/>
    
      <category term="索引" scheme="http://www.lilhui.com/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列6】OOM调优</title>
    <link href="http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_6/"/>
    <id>http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_6/</id>
    <published>2021-05-10T16:03:18.000Z</published>
    <updated>2021-05-10T16:06:37.263Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVM-OOM"><a href="#JVM-OOM" class="headerlink" title="JVM OOM"></a>JVM OOM</h2><ul><li>堆区<br>Heap</li><li>方法区<br>Per</li><li>栈区<br>StackOverFlow</li></ul><h2 id="元空间"><a href="#元空间" class="headerlink" title="元空间"></a>元空间</h2><p>调优参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-XX:MetaspaceSize=10m</div><div class="line">-XX:MaxMetaspaceSize=10m</div></pre></td></tr></table></figure><p>1、最大、最小设置成一样大。<br>2、程序运行起来后，通过visualVM、arthas查看占用了多少内存，向上调优，预留20%以上的空间。</p><h2 id="虚拟机堆"><a href="#虚拟机堆" class="headerlink" title="虚拟机堆"></a>虚拟机堆</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[GC (Allocation Failure) [PSYoungGen: 1344K-&gt;320K(2048K)] 7894K-&gt;7118K(9216K), 0.0071516 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] </div><div class="line"></div><div class="line">[GC类型 (GC原因) [新生代垃圾收集器: gc前新生代的内存使用情况-&gt;gc后新生代的内存使用情况(新生代总内存)] gc前堆内存的使用情况-&gt;gc后堆内存的使用情况(堆总内存), gc耗时] [Times: gc阶段用户空间耗时 gc阶段内核空间耗时, gc阶段实际耗时] </div><div class="line"></div><div class="line">[Full GC (Ergonomics) [PSYoungGen: 320K-&gt;0K(2048K)] [ParOldGen: 6798K-&gt;5930K(7168K)] 7118K-&gt;5930K(9216K), [Metaspace: 9296K-&gt;9233K(1058816K)], 0.6733958 secs] [Times: user=1.76 sys=0.00, real=0.68 secs] </div><div class="line"></div><div class="line">[GC类型 (GC原因) [新生代垃圾收集器: gc前新生代的内存使用情况-&gt;gc后新生代的内存使用情况(新生代总内存)] [老年代垃圾收集器: gc前老年代的内存使用情况-&gt;gc后老年代的内存使用情况(新生代总内存)] gc前堆内存的使用情况-&gt;gc后堆内存的使用情况(堆总内存), [Metaspace: gc前元空间的内存使用情况-&gt;gc后元空间的内存使用情况(元空间总内存)], gc耗时] [Times: gc阶段用户空间耗时 gc阶段内核空间耗时, gc阶段实际耗时]</div></pre></td></tr></table></figure><ul><li>调优参数</li></ul><p>-Xms10m -Xmx10m</p><p>1、预留30%以上的空间<br>2、周期性看日志，重点关注full gc频率</p><h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><ul><li>调优参数</li></ul><p>-Xmss200k</p><p>栈大小相同，栈深度不同，为什么？<br>因为栈上会分配数据。导致栈帧变大。深度会变浅。</p><h2 id="调优工具"><a href="#调优工具" class="headerlink" title="调优工具"></a>调优工具</h2><ol><li>jps</li></ol><p>-q：只显示Java进程的ID</p><p>-m：输出Java进程的ID + main函数所在类的名词 + 传递给main函数的参数</p><p>-l：输出Java进程的ID + main函数所在类的全限定名（包名 + 类名）</p><p>-v：输出Java进程的ID + main函数所在类的名称 + 传递给JVM的参数<br>应用：可通过此方式快速查看JVM参数是否设置成功</p><p>-V、hostid基本用不到，这里就不做介绍了，感兴趣的同学可以自行百度学习。</p><ul><li>如何识别Java进程</li></ul><p>jps输出的信息全是Java进程的信息，是如何做到的？</p><p>Java进程在创建的时候，会生成相应的文件，进程相关的信息会写入该文件中。Windows下默认理解是</p><ol><li>jstate</li></ol><p>Hotspot自带的工具，通过该工具可实时了解某个进程的class、compile、gc、memory的相关信息。具体可通过该工具查看哪些信息可通过jstat -options查看.</p><p>为什么说是实时呢，因为底层实现是mmap，及内存映射文件</p><ul><li><p>jstat输出的这些值从哪来的<br>PerfData文件<br>Windows下默认理解是C:\Users\username\AppData\Local\Temp\hsperfdata_username<br>Linux下默认路径是/tmp/hsperfdata_username</p></li><li><p>PerfData文件</p></li></ul><p>1、文件创建<br>取决于两个参数<br>-XX:-/+UsePerfData<br>默认是开启的<br>关闭方式：-XX:-UsePerfData。如果关闭了，就不会创建PerfData文件<br>-XX:-/+PerfDisableSharedMem（禁用共享内存）<br>默认是关闭的，即支持内存共享。如果禁用了，依赖于PerfData文件的工具就无法正常工作了<br>2、文件删除<br>默认情况下随Java进程的结束而销毁<br>3、文件更新<br>-XX:PerfDataSamplingInterval = 50ms<br>即内存与PerfData文件的数据延迟为50ms</p><p>纯Java编写<br>\openjdk\jdk\src\share\classes\sun\tools\jstat\Jstat.java</p><p>3、jinfo<br>4、jstack<br>5、jmap<br>6、jconsole<br>7、visualVM<br>8、arthas</p><h3 id="Java-agent"><a href="#Java-agent" class="headerlink" title="Java agent"></a>Java agent</h3><p>1、命令行<br>2、attach</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>1、统计线程数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstack -l 6972 | grep &apos;java.lang.Thread.State&apos; | wc -l</div></pre></td></tr></table></figure><p>2、检测死锁</p><p>可使用jstack、jconsle、visualVM</p><p>3、CPU占用过高</p><ol><li>定位到占用CPU最高的进程</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -H -p 6290</div></pre></td></tr></table></figure><p>线程ID由十进制转成十六进制，用Python</p><p>jstack 6290（进程ID）|grep 18a1（线程ID，十六进制） -A 30</p><p>问题：<br>模拟OOM并思考如何调优<br>死锁、CPU占用过高问题排查<br>Java Agent的两种实现方式自己写DEMO  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;JVM-OOM&quot;&gt;&lt;a href=&quot;#JVM-OOM&quot; class=&quot;headerlink&quot; title=&quot;JVM OOM&quot;&gt;&lt;/a&gt;JVM OOM&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;堆区&lt;br&gt;Heap&lt;/li&gt;
&lt;li&gt;方法区&lt;br&gt;Per&lt;/li&gt;
&lt;li&gt;栈区&lt;b
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列5】精通垃圾回收</title>
    <link href="http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_5/"/>
    <id>http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_5/</id>
    <published>2021-05-10T16:01:52.000Z</published>
    <updated>2021-05-10T16:06:37.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="分代复制算法指针移动原理"><a href="#分代复制算法指针移动原理" class="headerlink" title="分代复制算法指针移动原理"></a>分代复制算法指针移动原理</h2><p>数据发生了移动，为什么依然能够访问到。</p><p>JVM四大层面</p><p>java语法<br>java字节码<br>openjdk原理</p><p>openJdk源码</p><h2 id="强软弱虚引用"><a href="#强软弱虚引用" class="headerlink" title="强软弱虚引用"></a>强软弱虚引用</h2><p>前提：<br>未发生GC 所有的对象都是白色。<br>发生GC时新建的对象都是hi黑色。</p><ul><li>标记阶段做的事情</li></ul><ol><li><p>初始化标记<br>只标记 GC Roots直接关联的对象</p><p>对象直接充当GC Root</p><p>只标记A,E 标记成灰色</p><p>会STW，耗时很少。</p></li><li><p>并发标记阶段 （三色标记）<br>不需要STW<br>耗时很久<br>将GC Roots直接关联的对象所有引用链全部跑一遍<br>一层一层遍历，正常所有被标记的都会变成黑色。</p></li></ol><ul><li>三色标记</li></ul><p>GC:<br>串行<br>用户线程会STW<br>一个Thread执行gc<br>并行<br>用户线程STW,多个GC线程运行<br>并发<br>不需要STW,用户线程，GC线程并发。（需要三色标记）</p><ol><li>最终标记</li></ol><p>并发标记会带来三个问题</p><ol><li>多标<br>A-&gt;B-C  A是黑色，B是灰色，C是白色，此时 A不引用B了。B还是灰色，没有变成黑色。 不会被回收。</li><li><p>少标<br>标记程序在运行的过程中，用户线程依然创建对象。</p><p>由于是新创建的所以是黑色的。<br>创建的对象会躲过这次GC,但是下次GC有可能会被回收。</p></li><li><p>漏标<br>GC标记程序运行过程中，引用链发生改变。</p><p>B（灰）对D引用取消了。<br>A（黑）引用了D.<br>这个会导致D被回收，执行就会报错。</p></li></ol><p>解决方法：增量更新，原始快照。</p><p>多标和少标在下轮GC会被回收掉。</p><p>如何解决漏标：</p><ol><li><p>当黑色对象直接引用了一个白色对象后，我们就将这个黑色对象记录下来（加入 oopMap)，在扫描完成后，重新对这个黑色对象扫描,这个就是<strong>增量更新</strong>（Incremental Update）</p></li><li><p>当删除了灰色对象到白色对象的直接或间接引用后，就将这个灰色对象记录下来，再以此灰色对象为根，重新扫描一次。这个就是<strong>原始快照</strong>（Snapshot At TheBeginning，SATB）</p></li></ol><ul><li>读写屏障</li></ul><p>原方法write</p><p>在执行前加上 pre_write,在执行之后执行 post_write。</p><h2 id="核心垃圾回收期"><a href="#核心垃圾回收期" class="headerlink" title="核心垃圾回收期"></a>核心垃圾回收期</h2><p>现在的垃圾回收期发展趋势：模块化，支持并发。<br>默认 Parallel Scvenge，Parallel Old</p><h3 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h3><p>分代<br>写屏障 + 增量更新</p><h3 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h3><p>基于region 默认2M，4M,8M,16,32M</p><p>2048个Regin<br>每个 region都可以是e,f,to老年代，但是一个region只能有一个角色。</p><p>控制耗时</p><p>Garbege First == G1</p><p>为什么耗内存？<br>20% - 30% 内存存一些数据结构。<br>优先队列维护一个 Region优先级数据。每次回收10ms。能回收几个region算几个。</p><p>空间换时间。</p><ul><li>记忆集与卡表</li></ul><p>首先跨代引用的问题？</p><p>存在跨代引用时，在进行YGC时，如果young generation的Y对象被old generation中O对象引用，那么称O对象存在跨代引用，而且Y对象应该在本次垃圾回收中存活下来，所以old generation的对象在YGC时也是Strong root的一部分，如果每次YGC都去扫描old generation中所有对象的话，肯定会非常耗时。</p><p>解决跨代引用<br>老年代引用新生代。<br>YGC时候对象被回收了。老年代会报错<br>新生代引用老年代。<br>YGC时候，也要扫描整个老年代，非常耗时。</p><p>记忆集：GenRemSet<br>卡表：CardTable</p><p>记忆集是一个理论，卡表是实现。</p><ul><li><p>卡表的实现原理<br>每个Region 2M.<br>卡表<br>卡页</p><p>卡表中有2048个卡页</p><p>一个卡页对应一个Region<br>一个卡页是512B</p><p>卡页中的一个B标识Region中的4KB(2M/512)<br>00000001<br>标记这个region是否有对年轻代的引用。</p></li></ul><p>如果没有记忆集：<br>需要遍历所有的老年代的region,遍历所有region中的所有对象。</p><p>说白了，记忆标记了某个region是否有引用年亲代引用，然后只遍历有年轻代引用的region。减少了遍历的region数量。</p><ul><li>savePoint</li></ul><p>安全点：</p><p>150 + 90 + 275 - 40 = </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;分代复制算法指针移动原理&quot;&gt;&lt;a href=&quot;#分代复制算法指针移动原理&quot; class=&quot;headerlink&quot; title=&quot;分代复制算法指针移动原理&quot;&gt;&lt;/a&gt;分代复制算法指针移动原理&lt;/h2&gt;&lt;p&gt;数据发生了移动，为什么依然能够访问到。&lt;/p&gt;
&lt;p&gt;JVM
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列4】精通String</title>
    <link href="http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_4/"/>
    <id>http://www.lilhui.com/2021/05/11/java/jvm/jvm_deep_4/</id>
    <published>2021-05-10T16:00:07.000Z</published>
    <updated>2021-05-11T13:17:56.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h2><p>String s2 = “dd” + new String(“test”);<br>四个 string<br>3个char</p><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>UseCompressedoops<br>压缩的是对象指针的长度</p><p>UseCompressedClassPointers<br>压缩的是klass对象指针的长度</p><p>如果不压缩，则在arrayOopDesc中声明的非静态字段之后分配，如果压缩，它将占用oopDesc中_klass字段的后半部分。</p><ul><li><p>数组长度怎么算</p><p>数组<br>对应的klass是：TypeArrayKlass实例<br>对应的oop：TypeArrayOop</p><p>对象的内存布局</p><pre><code>对象头    mark word    klass pointer实例数据填充</code></pre><p>不开启解压的情况：<br>Mark word 8B<br>klass point<br>metadata._compressed_klass<br>数组长度4B</p><pre><code>这种情况下，klass + 数组长度用了多少字节    12 = 8 + 4开启压缩的情况下：_metadata._compressed_klass 数组长度4Bklass + 数组长度= 4 + 4 = 8B</code></pre></li></ul><p>=====</p><h2 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h2><p>可重入锁很像 lock + 1 unlock -1 计数==0<br>释放</p><p>对象存活依据</p><ul><li><p>引用计数</p><p>例外，无法处理循环依赖。</p><p>初始化死锁</p></li><li><p>可达性分析</p><p>GC Roots<br>oop<br>局部变量表<br>字符串常量池</p></li></ul><p>JVM的GC</p><p>给存活的对象打标机，回收没有标记的对象。</p><h2 id="内存池"><a href="#内存池" class="headerlink" title="内存池"></a>内存池</h2><ul><li><p>内存分配算法<br>指针碰撞（openJdk, 无限CAS-失败就是已经被使用了 )</p><p>空闲列表：维护一个表存放 已用，空闲，已回收 描述。</p></li></ul><ol><li><p>Memory Pool内存池<br>管理内存块。<br>list<memorychunk *=""> m_chunks;<br>是一个列表，存放所有向OS申请的内存块。</memorychunk></p><ul><li><p>能做的事情<br>向OS要内存<br>mall哦错，calloc<br>释放内存<br>没有垃圾回收器，需要手动释放</p><p>其他<br>打印chunk信息</p></li></ul></li><li><p>Memory chunk<br>直接持有内存</p></li><li><p>Memory Cell<br>chunk中的单元。内存块。</p></li></ol><p>Memory Pool</p><ol><li>根据要的内存对齐后计算出要申请的内存大小。</li><li>向操作系统申请内存。</li><li><p>根据不同的垃圾回收算法填充不同的list<br>标记清除，标记-整理，回收的是整个chunk.</p><pre><code>m_avaliable_tablem_used_table</code></pre><p> 分代+复制算法，</p><pre><code>空闲可用已用待交换</code></pre></li></ol><ul><li><p>标记-清除算法<br>面向整个堆<br>产生碎片</p><p>如果你需要分配大对象，需要连续的空间。但是内存是碎片化的。</p></li><li><p>标记-整理算法<br>内存碎片合并<br>老年代基本属于这个算法。</p><p>合并内存，解决碎片问题。<br>耗CPU</p></li></ul><pre><code>Eden区，对象朝生夕死。碎片很多。碎片很多，合并碎片的时候需要STW。合并碎片的时候有两种对象需要处理：    1. 这个空间已被释放。直接合并    2. 这个空间的空间未被释放        对象搬家（合并内存，数据移动，指针移动）</code></pre><ul><li>分代-复制算法<br>JVM使用这个算法，解决标记合并碎片消耗性能过高、GC停止用户线程过长问题。<br>举例<ol><li>将内存分段。 一半用（0-10） from，一半闲（11-20）to</li><li>发生GC的时候不需要整理，交换空间标记，角色切换。<br>标记<br>角色切换<br>原先from区的内存处理<br>标记的对象清理。存活的对象需要移动到新的内存区域（to 区）<br>数据整理<br>指针整理</li></ol></li></ul><p>注意：<br>不管现在的9种垃圾回收器，还是以后出现的垃圾回收器，都是这三种垃圾回收算法。</p><p>指针移动，老的指针地址不能变，这个怎么做到？(对象的hashCode不变)<br>指针是动态计算出来的。<br>公式依赖的变量在变。</p><p>return (pvoid)((ulong)chunk-&gt;get_data() + get_start()* chunk-&gt;get_align_size() )<br>卡表，记忆集</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>内存池，JVM不需要手动释放内存，由垃圾回收器自动回收。</p><p>自动回收算法</p><p>标记-清除算法。面向整个堆，会产生碎片，在申请大对象时候，会有问题。</p><p>标记-整理算法。老年代常用，会在标记清理后整理内存，但是CPU耗费太大，STW时间会比较长。<br>标记，清理，数据整理，指针整理。</p><p>数据块(chunk cell)整理过程<br>从前到后合并一次<br>从后到前合并一次<br>分代-复制<br>解决整理算法性能太低，而且新生代的特点是朝生夕死。</p><pre><code>不需要清理，只需要转移数据和指针切换 from,to角色问题：      指针切换了以后为什么可以访问？    hashcode会一直变。运行时计算出来的，所以没影响。</code></pre><p>PS:对象模型，为什么要字节对齐。8B<br>CPU提升速率。<br>CPU读是 4</p><pre><code>当数据从1字节开始的时候，问题很复杂，首先先将前4个字节读到寄存器，并再次读取4-7字节的数据进寄存器，接着把0字节，4,6,7字节的数据剔除，最后合并1,2,3,4字节的数据进寄存器，对一个内存未对齐的寄存器进行了这么多额外操作，大大降低了CPU的性能。但是这还属于乐观情况，上文提到内存对齐的作用之一是平台的移植原因，因为只有部分CPU肯干，其他部分CPU遇到未对齐边界就直接罢工了。</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;遗留问题&quot;&gt;&lt;a href=&quot;#遗留问题&quot; class=&quot;headerlink&quot; title=&quot;遗留问题&quot;&gt;&lt;/a&gt;遗留问题&lt;/h2&gt;&lt;p&gt;String s2 = “dd” + new String(“test”);&lt;br&gt;四个 string&lt;br&gt;3个char&lt;
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列3】底层优化</title>
    <link href="http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_3/"/>
    <id>http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_3/</id>
    <published>2021-05-10T15:58:06.000Z</published>
    <updated>2021-05-10T16:00:32.960Z</updated>
    
    <content type="html"><![CDATA[<p>对象布局</p><pre><code>对象头    Mark Word        32bit   4B        64bit   8B    类型指针    Klass pointer        对象所属类的元信息的实例指针            instanceKlass        指针压缩            开启后  4B            关闭    8B    数组长度        如果这个对象不是数组 占 0B        如果这个对象是数组 占4B 表示这个对象数组的元素个数实例数据    类的非静态属性，生成对象就是实例数据。    对象属性    boolean 2B    byte 1B    char 2B    int 4B    float 4B    double 8B    引用类型：4B(指针压缩) 8B(不压缩)    long 8B对齐填充    8B字节对齐，java中所有的对象都是8B字节对齐。    如果一个对象占3个字节，JVM会补2个字节凑成32B达到8字节对齐。    为什么要做填充？        1. 效率提高</code></pre><p>计算类大小</p><p>指针压缩<br>开启后指针压缩<br>16B = 8B（markword)+ 4B(klass point) + 0B + 0B = 12<br>需要补到16<br>关闭指针压缩<br>16B = 8 + 8 + 0 + 0</p><p>数组对象<br>开启指针压缩</p><p>数组对象在关闭指针压缩的情况下，会出现两端填充。<br>不止这一种情况。</p><p>一个OOP能标识最大堆空间</p><p>32bit内存最大 4G</p><p>一个OOP,存储的时候是3B,32bit<br>使用的时候胃部补了3个0， 35bit</p><p>OOP32G瓶颈</p><p>32G不够用了，需要扩容怎么办？<br>解决方法：8字节对齐 改成16字节对齐。</p><p>8 自己对齐，内存地址会补3个0.16字节对齐会补4个0<br>32G*2 = 64G<br>改源码。</p><p>JDK为什么没用16字节对齐</p><pre><code>1. 没必要32G已经极限了。GC耗费CPU资源。太大，暂停时间太长。2. 非空间</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li>对象的两种内存结构 kclass,oop</li><li>计算三种类型的对象大小。</li><li>指针压缩</li></ol><h2 id="调优"><a href="#调优" class="headerlink" title="调优"></a>调优</h2><ol><li>项目上线前的预估调优。</li><li>项目上线初期，基于日志做一些基础调优。</li><li>发生oom，频繁full gc，做测地的调优</li></ol><ul><li>调优的点</li></ul><ol><li>jvm内存模型的调优。</li><li>热点代码缓冲区的调优。</li></ol><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><ul><li>亿级流量项目的调优</li></ul><p>一个UV会访问20个左右的PV<br>500W用户。</p><p>下单转换率 10% = 50W</p><p>40%订单在前两小时四完成。<br>每分钟1200笔订单。<br>周边流量都加起来，大概</p><p>没妙产生200M对象<br>总共2700M</p><p>每个操作要3秒 200 * 3 = 600<br>每秒钟 600M对象进入Eden区</p><p>14秒发生一次young gc</p><p>600M对象还存活，无法被回收</p><p>触发空间担保。</p><p>老年代6400M<br>多长时间触发一次fullgc</p><p>9 * 14 = 126秒一次full gc</p><p>本质：<br>有对象在young gc时未被清理干净。<br>触发空间担保，动态年龄判断，15次<br>进入了老年代。</p><ul><li>解决之道：</li></ul><p>对象尽量在 young gc阶段回收掉。</p><p>堆最小是物理内存的64份之一，最大是物理内存的4分之一。</p><p>oop<br>java对象在JVM中的存在形式</p><pre><code>opp-klass模型</code></pre><p>两种对象内存结构<br>条虫</p><p>计算三种类型的对象<br>开启指针压缩<br>关闭指针压缩<br>指针压缩<br>实现原理<br>32G瓶颈<br>如何扩展<br>JDK源码，OS源码<br>何为JVM调优</p><ol><li>预估调优</li><li>小规模调优</li><li>OOM,full gc频繁<br>调什么？</li><li>方法区</li><li>虚拟机栈</li><li>堆区</li><li>热点代码缓冲区</li></ol><p>亿级流量预估调试实战</p><p>GC日志</p><p>减少fullgc stw时间太长。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;对象布局&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;对象头
    Mark Word
        32bit   4B
        64bit   8B
    类型指针    Klass pointer
        对象所属类的元信息的实例指针
            
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列2】执行引擎</title>
    <link href="http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_2/"/>
    <id>http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_2/</id>
    <published>2021-05-10T15:52:31.000Z</published>
    <updated>2021-05-10T16:00:32.952Z</updated>
    
    <content type="html"><![CDATA[<h2 id="执行引擎"><a href="#执行引擎" class="headerlink" title="执行引擎"></a>执行引擎</h2><p>JVM运行Java程序的一套子系统</p><pre><code>两种解释器字节码解释器    Java字节码-&gt; C++代码-&gt;硬件编码模板解释器    Java字节码-&gt;硬件编码    底层实现过程    1. 申请一块内存：可读可写可执行。2. 将处理new字节码的硬编码拿过来    3. 将处理new字节码的硬编码写入申请的内存。    4. 申请一个函数指针，用这个函数指针执行这块内存。    5. 调用的时候，直接通过这个指针调用。</code></pre><h2 id="三种运行模式"><a href="#三种运行模式" class="headerlink" title="三种运行模式"></a>三种运行模式</h2><ol><li>-Xint</li><li>-Xcomp</li><li>-Xmixed</li></ol><h2 id="编译优化"><a href="#编译优化" class="headerlink" title="编译优化"></a>编译优化</h2><p>正常的C++函数生成的硬编码都有堆栈操作。</p><ul><li><p>字节码解释器<br>解释执行的<br>和编译器没关系</p></li><li><p>模板解释器<br>执行的因编码是即时编译器编译的。</p></li></ul><h3 id="JIT"><a href="#JIT" class="headerlink" title="JIT"></a>JIT</h3><p>即时编译器</p><pre><code>C1    c1编译器在client模式下的即时编译器    1. 比C2搜集的数据少。触发宽松。    2. 编译优化比较浅。    3. C1编译器生成的代码执行效率低。C2    C2编译器是server模式下的即时编译器    1. 触发条件比较严格，程序运行一段时间后才执行。    2. 优化比较深。    3. 编译生成的代码比C1效率高混合编译器</code></pre><hr><pre><code>GraalVM</code></pre><ul><li><p>即时编译触发条件</p><p>硬编码<br>热点代码</p></li></ul><p>注意：即时编译的最小单位是代码块。</p><ul><li>N热度：</li></ul><p>生成热点代码<br>client，N默认是1500<br>server，N默认是10000</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -client -XX:+PrintFlagsFinal -version</div></pre></td></tr></table></figure><ul><li><p>热度衰减：<br>new 7000<br>一段时间么执行后会2倍速递减 -&gt; 3500</p></li><li><p>经典故障</p><p>  业务增长，加节点。热机切冷机</p></li></ul><p>冷机：刚运行不久<br>热机：运行了一段时间</p><ul><li>节点。相同配置节点加入。负载均衡平摊压力。</li></ul><p>热机有热点代码缓存了，并发更大。</p><ol><li>热机能承受的并发大于冷机。</li><li>冷机一边在增加流量一遍在即时编译。性能就降低。</li></ol><p>问题：热点代码缓存在哪里？<br>方法区：<br>CodeCache（调优方向之一）<br>server 2496 2M，<br>client模式下160k</p><h2 id="即时编译是如何运行的"><a href="#即时编译是如何运行的" class="headerlink" title="即时编译是如何运行的"></a>即时编译是如何运行的</h2><p>VM_THREAD<br>GC</p><p>队列存放及时编译任务。当触发即时编译时会将编译任务放到及时编译队列里。</p><p>1、 触发及时编译任务入队列。<br>2、 VM_THREAD执行队列任务。</p><p>异步。</p><p>即时编译的线程有多少，如何调优？</p><p>硬编码，热点代码<br>热点代码存在哪里？热点代码缓冲区在哪里？</p><p>热点代码缓冲区，在方法区。</p><ul><li>逃逸分析</li></ul><p>逃逸<br>是一种现象</p><pre><code>对象作用域    局部变量，非逃逸    非局部变量，逃逸。方法外，线程外。</code></pre><p>基于逃逸技术，JVM开发了三种优化技术。</p><pre><code>1. 栈上分配2. 标量替换    标量： 不可再分，java中的基本类型就是标量。3. 锁消除    没竞争的锁，会消除掉。</code></pre><ul><li>栈上分配</li></ul><p>如何通过代码测试？</p><pre><code>对象在兑取分配对象在虚拟机栈上分配。HSDBJDK8的栈上分配存在吗？生成一个对象100W次，在栈上是不是又100W个。如果没有，就存在栈上分配，不发生GC的情况下。</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;执行引擎&quot;&gt;&lt;a href=&quot;#执行引擎&quot; class=&quot;headerlink&quot; title=&quot;执行引擎&quot;&gt;&lt;/a&gt;执行引擎&lt;/h2&gt;&lt;p&gt;JVM运行Java程序的一套子系统&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;两种解释器

字节码解释器
    Java字节码-&amp;gt
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>【JVM深入理解系列1】JVM底层加载</title>
    <link href="http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_1/"/>
    <id>http://www.lilhui.com/2021/05/10/java/jvm/jvm_deep_1/</id>
    <published>2021-05-10T15:47:37.000Z</published>
    <updated>2021-05-10T15:52:47.661Z</updated>
    
    <content type="html"><![CDATA[<h2 id="klass模型"><a href="#klass模型" class="headerlink" title="klass模型"></a>klass模型</h2><p>java的每个类在JVM中都有一个对应的klass类实例与之对应，存储类的元信息：常量池、属性信息、方法信息</p><p>MetaspaceObj</p><pre><code>Metadata    klass        instanceKlass            instanceMirrorKlass买奥数java.lang.Class实例            instanceRefKlass描述java.lang.Reference的子类            instanceClassLoaderKlass        ArrayKlass            TypeArrayKlass描述java基本类型数组的数据结构            ObjectArrayKlass描述java中引用类型数组的数据结构。</code></pre><p>类的元信息是存储在元空间的。</p><p>普通的Java类在JVM对应的是instanceKlass的实例。三个类：</p><ol><li>InstanceMirrorKlass:用于表示java.lang.class, Java代码中获取到的class对象，实际上是这个C++类的实例。存储在堆区，学名镜像类。</li><li>InstanceRefClass：用于表示Java.lang.ref.Referece的子类。</li><li>InstanceClassLoader:用于遍历某个加载器加载的类。</li></ol><p>Java中的数组不是静态数组类型，是动态数据类型，既是运行时期生成的，Java数组的元信息用ArrayKlass的子类来表示</p><ol><li>TypeArrayKlass:表示基本类型的数组。</li><li>ObjectArrayKlass:表示引用类型的数组。</li></ol><h2 id="类加载的过程"><a href="#类加载的过程" class="headerlink" title="类加载的过程"></a>类加载的过程</h2><p>七个过程：</p><p>loading -&gt; verification -preparation -&gt; resolution<br>-&gt; initialization -&gt; Using -&gt; Unloading</p><h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><ol><li>通过类的全限定名获取存储该类的class文件。</li><li>解析成运行时数据，InstanceKlasss实例。存放在方法区。</li><li>在堆区生成该类的class对象，InstanceMirrorKlass实例。</li></ol><p>程序怎么写都可以。只要满足上面三个效果就OK。改写OpenJdk源码，满足上面三个条件就Ok</p><ul><li>何时加载</li></ul><p>主动使用时</p><ol><li>new, getstatic, putstatic, invokestatic</li><li>反射</li><li>初始化一个类的子类去加载其父类。</li><li>启动类（main函数所在类）</li><li>当使用JDK1.7动态语言时，如果一个java.lang.invoke.MethodHandler实例最后的解析结果。REF_getStatic,REF_putStatic,REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行初始化，则需要先触发其初始化。</li></ol><ul><li>预加载：包装类，String, Thread</li></ul><p>因为没有指明必须从哪里获取class文件，脑洞大开的工程师开发了这些：</p><ol><li>从压缩包中读取，jar，war</li><li>从网络中读取，web applet</li><li>动态生成，如 动态代理，CGLIB</li><li>由其他文件生成，如JSP</li><li>从数据库读取。</li><li>从加密文件中读取</li></ol><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><ol><li>文件格式验证</li><li>元数据验证</li><li>字节码验证</li><li>符号引用验证</li></ol><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>为静态变量分配内存，赋初值。<br>实例变量是在创建对象的时候完成赋值的，没有赋初值一说。</p><p>int,long,short,char,byte,boolean,float,double,reference</p><p>如果被final修饰，在编译的时候会给属性添加ConstantValue属性，准备阶段直接完成赋值，既没有赋初值这一说。</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>将常量池中的符号引用转为直接引用</p><p>解析后的信息存储在ConstantPoolCache类实例中</p><ol><li>类或接口的解析。</li><li>字段解析</li><li>方法解析</li><li>接口方法解析</li></ol><ul><li>何时解析</li></ul><p>思路：</p><ol><li>加载阶段解析常量池时</li><li>用的时候</li></ol><p>openjdk是第二种思路，在执行特定的字节码指令之前进行解析：</p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>执行静态代码块，完成静态变量的赋值。<br>静态字段，静态代码段，字节码层面会生成clinit方法。<br>方法中语句的先手顺序与代码的编写顺序相关。</p><h2 id="类加载细节"><a href="#类加载细节" class="headerlink" title="类加载细节"></a>类加载细节</h2><p>有空了再补</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;klass模型&quot;&gt;&lt;a href=&quot;#klass模型&quot; class=&quot;headerlink&quot; title=&quot;klass模型&quot;&gt;&lt;/a&gt;klass模型&lt;/h2&gt;&lt;p&gt;java的每个类在JVM中都有一个对应的klass类实例与之对应，存储类的元信息：常量池、属性信息、
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="jvm" scheme="http://www.lilhui.com/categories/java/jvm/"/>
    
    
      <category term="java" scheme="http://www.lilhui.com/tags/java/"/>
    
      <category term="jvm调优" scheme="http://www.lilhui.com/tags/jvm%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>谈判的四大金刚</title>
    <link href="http://www.lilhui.com/2020/08/25/article/teammanager/teammanager_3/"/>
    <id>http://www.lilhui.com/2020/08/25/article/teammanager/teammanager_3/</id>
    <published>2020-08-25T01:46:44.000Z</published>
    <updated>2020-08-25T02:25:10.137Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一个单体的个人对外界信息的反馈可以分为</p></blockquote><ul><li>梦想型</li><li>计划型</li><li>恋人型</li><li>勇士型</li></ul><p>梦想型，主导方向（激励）。计划型，做逻辑预算（基于自我表达）。恋人型，拉近距离（共情）。勇士型，坚毅行动（直接的怼）。</p><blockquote><p>不同的场景应用以上不同的组合兵来将挡，水来土掩。一切的故事从针锋相对开始，到化干戈为玉帛结束。</p></blockquote><p>运用好，表现在在个人社交上，是魅力。在工作上是领导力。表现在家庭生活上是责任担当。</p><p>逻辑是可以从不便的事物中推理出改变的轨迹。然而人与人之间不讲逻辑的时候居多。</p><p>与死物讲逻辑，与活物打太极。绕进自己框架，将意识移植。改变不了对方的想法，就改变自己的想法。<br>这是个非零和博弈。  </p><blockquote><p>谈判三断式  </p></blockquote><ul><li>赞同  A</li><li>中立  B</li><li>共情  C</li><li>反对  D</li></ul><blockquote><p>有不同意见时候，采取比较适合的方式：</p></blockquote><p>ABDC</p><p>A开场，B阐述事实，D跑出观点，C安慰。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;一个单体的个人对外界信息的反馈可以分为&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;梦想型&lt;/li&gt;
&lt;li&gt;计划型&lt;/li&gt;
&lt;li&gt;恋人型&lt;/li&gt;
&lt;li&gt;勇士型&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;梦想型，主导方向（激励）。计划型，做逻辑
      
    
    </summary>
    
      <category term="技术之外" scheme="http://www.lilhui.com/categories/%E6%8A%80%E6%9C%AF%E4%B9%8B%E5%A4%96/"/>
    
    
      <category term="管理" scheme="http://www.lilhui.com/tags/%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:访问者模式</title>
    <link href="http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_21/"/>
    <id>http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_21/</id>
    <published>2020-04-07T05:07:44.000Z</published>
    <updated>2020-04-10T01:35:37.402Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p>访问者模式有点复杂。一般不轻易使用。他的主要任务是通过不同的访问器，访问问相同的对象，得到不同的信息<br>生成不同的报表等。  </p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/26a86d206f0003f09670a3d4d9fcc987" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li>Coputer被访问者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Computer</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 18:20</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</div><div class="line"></div><div class="line">    ComputerPart[] parts;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Computer</span><span class="params">()</span></span>&#123;</div><div class="line">        parts = <span class="keyword">new</span> ComputerPart[] &#123;<span class="keyword">new</span> Screen(), <span class="keyword">new</span> Keyboard()&#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parts.length; i++) &#123;</div><div class="line">            parts[i].accept(computerPartVisitor);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>ComputerPart 被访问者，被访问的部分</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComputerPart</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>ComputerPartVisitor 访问者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComputerPartVisitor</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Screen screen)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Keyboard keyboard)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Keyboard ,Screen 具体的电脑访问部分对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Keyboard</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</div><div class="line">        computerPartVisitor.visit(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Screen</span> <span class="keyword">implements</span> <span class="title">ComputerPart</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ComputerPartVisitor computerPartVisitor)</span> </span>&#123;</div><div class="line">        computerPartVisitor.visit(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>访问接口 Visitor</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ComputerPart computerPart)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Client客户端调用方式</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ComputerPart computer = <span class="keyword">new</span> Computer();</div><div class="line">        computer.accept(<span class="keyword">new</span> ComputerPartDisplayVisitor());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>执行结果</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Connected to the target VM, address: &apos;127.0.0.1:51341&apos;, transport: &apos;socket&apos;</div><div class="line">this is computer screen</div><div class="line">this is computer keyboard</div><div class="line">Disconnected from the target VM, address: &apos;127.0.0.1:51341&apos;, transport: &apos;socket&apos;</div><div class="line"></div><div class="line">Process finished with exit code 0</div></pre></td></tr></table></figure><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>访问者模式一般用于当对象属性或者信息太多，太杂的时候，通过不同的访问器（观察角度），访问不同的信息。<br>并且可以对信息进行二次加工。具体场景如：<br>1：员工的绩效评估，工程师和HR评估的角度不同。访问角度不同，这时候<br>访问者模式就比较适合。<br>2：报表，老板看到的报表和团队看到的项目报表肯定不一样。这时就满足访问者模式场景。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来讲，访问者模式提供多角度对同个对象的观测方式。对其理解不深很深刻，总结可能不到位，以后再总结。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;访问者模式有点复杂。一般不轻易使用。他的主要任务是通过不同的访问器，访问问相同的对象，得到不同的信息&lt;br&gt;生成不
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="访问者模式" scheme="http://www.lilhui.com/tags/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:中介者模式</title>
    <link href="http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_22/"/>
    <id>http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_22/</id>
    <published>2020-04-07T05:07:44.000Z</published>
    <updated>2020-04-10T01:35:37.429Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p>定义一个中介者对象, 封装一系列对象的交互关系, 使得各对象不必显示的相互引用,<br>从而使其耦合松散, 而且可以独立的改变它们的交互.  </p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>以智能家居为例，小爱控制只能家居。</p><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/299215d0c0e1d6d6b58df5792de489c5" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li>SmartDevice 智能设备抽象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> SmartDevice</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:12</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SmartDevice</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">operateDevice</span><span class="params">(String instruction, SmartMediator mediator)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">readyState</span><span class="params">(String instruction)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>SmartMediator 中介者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> SmartMediator</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:12</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SmartMediator</span> </span>&#123;</div><div class="line">    SmartDevice bd;</div><div class="line">    SmartDevice md;</div><div class="line">    SmartDevice cd;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SmartMediator</span><span class="params">(SmartDevice bd, SmartDevice md, SmartDevice cd)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        <span class="keyword">this</span>.bd = bd;</div><div class="line">        <span class="keyword">this</span>.md = md;</div><div class="line">        <span class="keyword">this</span>.cd = cd;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">music</span><span class="params">(String instruction)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">curtain</span><span class="params">(String instruction)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">bath</span><span class="params">(String instruction)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><p>MusicDevice 智能播放器 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MusicDevice</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:15</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MusicDevice</span> <span class="keyword">extends</span> <span class="title">SmartDevice</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operateDevice</span><span class="params">(String instruction,SmartMediator mediator)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"音乐设备"</span>+instruction);</div><div class="line">        mediator.music(instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readyState</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"音乐设备准备"</span>+instruction);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>CurtainDevice 智能窗帘</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CurtainDevice</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:14</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurtainDevice</span> <span class="keyword">extends</span> <span class="title">SmartDevice</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operateDevice</span><span class="params">(String instruction, SmartMediator mediator)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"窗帘已"</span>+instruction);</div><div class="line">        mediator.curtain(instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readyState</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"窗帘设备准备"</span>+instruction);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>BathDevice 洗浴室</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> BathDevice</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:16</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BathDevice</span> <span class="keyword">extends</span> <span class="title">SmartDevice</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operateDevice</span><span class="params">(String instruction, SmartMediator mediator)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"洗浴设备"</span>+instruction);</div><div class="line">        mediator.bath(instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readyState</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"洗浴设备正在准备"</span>+instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Xiaoai 具体中介者 小爱</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Xiaoai</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:13</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Xiaoai</span> <span class="keyword">extends</span> <span class="title">SmartMediator</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Xiaoai</span><span class="params">(SmartDevice bd, SmartDevice md, SmartDevice cd)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(bd, md, cd);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">music</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"小爱操作音乐音乐"</span>);</div><div class="line">        cd.readyState(instruction);</div><div class="line">        bd.readyState(instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">curtain</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"小爱操作窗帘"</span>);</div><div class="line">        md.readyState(instruction);</div><div class="line">        bd.readyState(instruction);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bath</span><span class="params">(String instruction)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"小爱操作浴室"</span>);</div><div class="line">        cd.readyState(instruction);</div><div class="line">        md.readyState(instruction);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Client 客户端</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.mediator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Client</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/9 18:18</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SmartDevice bd = <span class="keyword">new</span> BathDevice();</div><div class="line">        SmartDevice cd = <span class="keyword">new</span> CurtainDevice();</div><div class="line">        SmartDevice md = <span class="keyword">new</span> MusicDevice();</div><div class="line">        SmartMediator sm = <span class="keyword">new</span> Xiaoai(bd, cd, md);</div><div class="line">        cd.operateDevice(<span class="string">"open"</span>,sm);</div><div class="line">        md.operateDevice(<span class="string">"close"</span>,sm);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>执行结果</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Connected to the target VM, address: &apos;127.0.0.1:60536&apos;, transport: &apos;socket&apos;</div><div class="line">窗帘已open</div><div class="line">小爱操作窗帘</div><div class="line">窗帘设备准备open</div><div class="line">洗浴设备正在准备open</div><div class="line">音乐设备已close</div><div class="line">小爱操作音乐音乐</div><div class="line">音乐设备准备close</div><div class="line">洗浴设备正在准备close</div><div class="line">Disconnected from the target VM, address: &apos;127.0.0.1:60536&apos;, transport: &apos;socket&apos;</div></pre></td></tr></table></figure><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>当有多个对象彼此间相互交互的时候，自然就会想到对象间的耦合度过高，解决办法就是封装对象间的交互行为，因此就能想到中介者模式就是干这行的。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p> 中介者的核心是抽离依赖关系。通过依赖关系来描述整个业务场景。使得复杂的逻辑可以内聚。</p><ul><li>中介者模式优点  <ol><li>通过让对象彼此解耦，增加对象的复用性</li><li>通过将控制逻辑集中，可以简化系统维护<br>通过中介者使一对所变成了一堆一，便于理解</li></ol></li><li>缺点  <ol><li>如果设计不好，引入中介者会使程序变的复杂</li><li>中介者承担过多责任，维护不好会出大事</li></ol></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;定义一个中介者对象, 封装一系列对象的交互关系, 使得各对象不必显示的相互引用,&lt;br&gt;从而使其耦合松散, 而且可
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="中介者模式" scheme="http://www.lilhui.com/tags/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:解释器模式</title>
    <link href="http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_23/"/>
    <id>http://www.lilhui.com/2020/04/07/java/patterndesign/patterndesign_23/</id>
    <published>2020-04-07T05:07:44.000Z</published>
    <updated>2020-04-10T02:31:23.519Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p>解释器模式实现了一个表达式接口，该接口解释一个特定的上下文。这种模式被用在 SQL 解析、符号处理引擎等。</p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/fc3cc988c12ee33d2ad48d9de91582cd" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li>Expression</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Expression</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/10 09:51</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Expression</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>OrExpression</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> OrExpress</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/10 10:25</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrExpression</span><span class="params">(Expression expr1, Expression expr2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.expr1 = expr1;</div><div class="line">        <span class="keyword">this</span>.expr2 = expr2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> expr1.interpret(context) || expr2.interpret(context);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>AndExpression</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> AndExpression</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/10 10:25</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Expression expr1 = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> Expression expr2 = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AndExpression</span><span class="params">(Expression expr1, Expression expr2)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.expr1 = expr1;</div><div class="line">        <span class="keyword">this</span>.expr2 = expr2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">interpret</span><span class="params">(String context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> expr1.interpret(context) &amp;&amp; expr2.interpret(context);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Client</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Client</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/10 10:26</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//规则：Robert 和 John 是男性</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMaleExpression</span><span class="params">()</span></span>&#123;</div><div class="line">        Expression robert = <span class="keyword">new</span> TerminalExpression(<span class="string">"Robert"</span>);</div><div class="line">        Expression john = <span class="keyword">new</span> TerminalExpression(<span class="string">"John"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrExpression(robert, john);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//规则：Julie 是一个已婚的女性</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">getMarriedWomanExpression</span><span class="params">()</span></span>&#123;</div><div class="line">        Expression julie = <span class="keyword">new</span> TerminalExpression(<span class="string">"Julie"</span>);</div><div class="line">        Expression married = <span class="keyword">new</span> TerminalExpression(<span class="string">"Married"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AndExpression(julie, married);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Expression isMale = getMaleExpression();</div><div class="line">        Expression isMarriedWoman = getMarriedWomanExpression();</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"John is male? "</span> + isMale.interpret(<span class="string">"John"</span>));</div><div class="line">        System.out.println(<span class="string">"Julie is a married women? "</span></div><div class="line">                + isMarriedWoman.interpret(<span class="string">"Married Julie"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>执行结果</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Connected to the target VM, address: &apos;127.0.0.1:61783&apos;, transport: &apos;socket&apos;</div><div class="line">John is male? true</div><div class="line">Julie is a married women? true</div><div class="line">Disconnected from the target VM, address: &apos;127.0.0.1:61783&apos;, transport: &apos;socket&apos;</div><div class="line"></div><div class="line">Process finished with exit code 0</div></pre></td></tr></table></figure><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ul><li>可以将一个需要解释执行的语言中的句子表示为一个抽象语法树</li><li>一些重复出现的问题可以用一种简单的语言来表达</li><li>一个简单语法需要解释的场景</li></ul><p>在一些编译器，运算表达式，正则表达式经常有使用。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><p>优点：<br>1、可扩展性比较好，灵活。<br>2、增加了新的解释表达式的方式。<br>3、易于实现简单文法。</p></li><li><p>缺点：<br>1、可利用场景比较少。<br>2、对于复杂的文法比较难维护。<br>3、解释器模式会引起类膨胀。<br>4、解释器模式采用递归调用方法。</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;解释器模式实现了一个表达式接口，该接口解释一个特定的上下文。这种模式被用在 SQL 解析、符号处理引擎等。&lt;/p&gt;
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="解释器模式" scheme="http://www.lilhui.com/tags/%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:命令模式</title>
    <link href="http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_18/"/>
    <id>http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_18/</id>
    <published>2020-01-08T08:07:44.000Z</published>
    <updated>2020-04-10T01:35:37.383Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p>命令模式将命令的执行和发送命令的责任分隔开，委派给不同的对象执行。</p></blockquote><ul><li>###涉及角色</li></ul><ol><li>客户端(Client)角色：创建一个具体命令(ConcreteCommand)对象并确定其接收者。</li><li>命令(Command)角色：声明了一个给所有具体命令类的抽象接口。</li><li>具体命令(ConcreteCommand)角色：定义一个接收者和行为之间的弱耦合；实现execute()方法，负责调用接收者的相应操作。execute()方法通常叫做执行方法。</li><li>请求者(Invoker)角色：负责调用命令对象执行请求，相关的方法叫做行动方法。</li><li>接收者(Receiver)角色：负责具体实施和执行一个请求。任何一个类都可以成为接收者，实施和执行请求的方法叫做行动方法。</li></ol><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/6d1454b9046f34f6d1a20dc0de9eb98b" alt="图片"></p><p><img src="http://images.lilhui.com/35c615bb6cee34ebf6f8ad578a7c57e0" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li><p>客户端<br>FishCommander</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> 鱼长官</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Client</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/8 16:29</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FishCommander</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        FishSoldier fishSoldier = <span class="keyword">new</span> FishSoldier();</div><div class="line">        Command huntingFishCommand = <span class="keyword">new</span> HuntingFishCommand(fishSoldier);</div><div class="line">        Command cookingFishCommand = <span class="keyword">new</span> CookingFishCommand(fishSoldier);</div><div class="line">        CommandBrodCast commandBrodCast = <span class="keyword">new</span> CommandBrodCast();</div><div class="line">        commandBrodCast.setCookingFishCommand(cookingFishCommand);</div><div class="line">        commandBrodCast.setHuntingFishCommand(huntingFishCommand);</div><div class="line">        commandBrodCast.huntingFish();</div><div class="line">        commandBrodCast.cookingFish();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>命令<br>Command接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p>HuntingFishCommand<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> HuntingFish</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/8 16:31</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HuntingFishCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</div><div class="line"></div><div class="line">    FishSoldier fishSoldier;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HuntingFishCommand</span><span class="params">(FishSoldier fishSoldier)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.fishSoldier = fishSoldier;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</div><div class="line">        fishSoldier.doHuntingFish();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>CookingFishCommand<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CookingFishCommand</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/8 16:32</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookingFishCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</div><div class="line"></div><div class="line">    FishSoldier fishSoldier;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CookingFishCommand</span><span class="params">(FishSoldier fishSoldier)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.fishSoldier = fishSoldier;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</div><div class="line">        fishSoldier.doCookingFish();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><ul><li>命令发送者请求者</li></ul><p>CommandBrodCast<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CommandInvoder</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/8 16:34</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandBrodCast</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Command huntingFishCommand;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Command cookingFishCommand;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookingFishCommand</span><span class="params">(Command cookingFishCommand)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.cookingFishCommand = cookingFishCommand;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHuntingFishCommand</span><span class="params">(Command huntingFishCommand)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.huntingFishCommand = huntingFishCommand;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cookingFish</span><span class="params">()</span> </span>&#123;</div><div class="line">        cookingFishCommand.execute();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">huntingFish</span><span class="params">()</span> </span>&#123;</div><div class="line">        huntingFishCommand.execute();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><ul><li>命令接收者</li></ul><p>FishSoldier<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.command;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Soldier</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/1/8 16:38</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FishSoldier</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doHuntingFish</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"hunting fish"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doCookingFish</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"cooking fish"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>命令模式的场景经常用在对外系统调用的时候使用。比如一个http请求封装成一个命模式。<br>不同的参数也可以封装成不同的命令。命令执行端，服务端的业务发生改变时或者url调用<br>方式发生改变时，客户端不需要调整。只要修改相应的命令封装器就好了。有效地做到<br>了修改的隔离。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>命令模式的最大特点就是隔离了命令的发送端和执行端。命令的发送端无需知道命令<br>执行端具体怎么执行。这种隔离方式的好处是调用的透明化。具有更好的扩展性。<br>由于命令是一个个相互独立的，所以可以很自然的做到复合命令。命令已经是封装<br>过的，所以可以对他进行有效的参数化。综合以上他有几种特点：</p><ol><li>更松散的耦合</li><li>更动态的控制</li><li>支持复合命令</li><li>更好的扩展性</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;命令模式将命令的执行和发送命令的责任分隔开，委派给不同的对象执行。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;

      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="命令模式" scheme="http://www.lilhui.com/tags/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:备忘录模式</title>
    <link href="http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_19/"/>
    <id>http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_19/</id>
    <published>2020-01-08T08:07:44.000Z</published>
    <updated>2020-04-10T01:35:37.388Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p> 备忘录保存的是类内部状态。在适当的时候可以用来恢复当时的类状态。还原现场。  </p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/d70b44ea3e5dab7e1dbb801c9828f31f" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li><p>Originator<br>执行者，封装备忘录具体属性信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.memoto;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Originator</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 14:45</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Originator</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String state;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 创建一个新的备忘录对象</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Memento(state);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 将发起者的状态恢复到备忘录的状态</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restore</span><span class="params">(Memento memento)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = memento.getState();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>Caretaker<br>备忘录管理者。包含一个备忘录具体对象，可以是list。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.memoto;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Caretaker</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 14:46</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Caretaker</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Memento mMemento;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Memento <span class="title">restoreMemento</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> mMemento;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeMemengto</span><span class="params">(Memento memento)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.mMemento = memento;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Memento<br>备忘录的具体类。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.memoto;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Memento</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 14:45</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memento</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String state;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Memento</span><span class="params">(String state)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>Client<br>执行流程</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.memoto;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Client</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 14:45</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">//发起 并初始化</span></div><div class="line">        Originator originator = <span class="keyword">new</span> Originator();</div><div class="line">        originator.setState(<span class="string">"state1"</span>);</div><div class="line"></div><div class="line">        <span class="comment">//备忘录管理</span></div><div class="line">        Caretaker caretaker = <span class="keyword">new</span> Caretaker();</div><div class="line">        caretaker.storeMemengto(originator.createMemento());</div><div class="line">        originator.setState(<span class="string">"state2"</span>);</div><div class="line">        System.out.println(originator);</div><div class="line"></div><div class="line">        <span class="comment">//备忘录 恢复</span></div><div class="line">        originator.restore(caretaker.restoreMemento());</div><div class="line">        System.out.println(originator);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>比如在玩游戏保存游戏进度的时候可以用来实现回退功能。回退到上一个保存点。等等</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><p>优点<br>备忘录模式存在的意义也是在于他的回复机制。并且其特点是在用户不必关心类的内部细节情况下完成了。<br>实现了信息封装。</p></li><li><p>缺点<br>由于备忘录的保存需要额外的存储空间，所以在类属性多的情况下，多次的备忘录操作比较消耗资源。</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt; 备忘录保存的是类内部状态。在适当的时候可以用来恢复当时的类状态。还原现场。  &lt;/p&gt;
&lt;/blockquote
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="备忘录模式" scheme="http://www.lilhui.com/tags/%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式系列:状态模式</title>
    <link href="http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_20/"/>
    <id>http://www.lilhui.com/2020/01/08/java/patterndesign/patterndesign_20/</id>
    <published>2020-01-08T08:07:44.000Z</published>
    <updated>2020-04-10T01:35:37.412Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote><p>状态模式是将对象的状态接口抽出，从状态的维度出发描述对象。对象千千万，状态<br>就那么几个，所以从状态的维度度量。业务上会清晰很多。  </p></blockquote><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="http://images.lilhui.com/13cc93043b1f94bb237d668ffba543e8" alt="图片"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ul><li><p>抽象状态 CarState</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CarState</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:09</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CarState</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doCarAction</span><span class="params">(Car car)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>具体状态 start,run,stop</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CarStart</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:10</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarStart</span> <span class="keyword">implements</span> <span class="title">CarState</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doCarAction</span><span class="params">(Car car)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"汽车启动中。"</span>);</div><div class="line">        car.setState(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CarRun</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:10</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarRun</span> <span class="keyword">implements</span> <span class="title">CarState</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doCarAction</span><span class="params">(Car car)</span> </span>&#123;</div><div class="line">        car.setState(<span class="number">2</span>);</div><div class="line">        System.out.println(<span class="string">"汽车在行驶中。"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CarStop</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:11</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarStop</span> <span class="keyword">implements</span> <span class="title">CarState</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doCarAction</span><span class="params">(Car car)</span> </span>&#123;</div><div class="line">        car.setState(<span class="number">0</span>);</div><div class="line">        System.out.println(<span class="string">"汽车停止。"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>上下文 Car</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Context</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:07</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 0 停止</span></div><div class="line"><span class="comment">     * 1 启动中</span></div><div class="line"><span class="comment">     * 2 奔跑中</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.state = state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>客户端调用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.littlehui.design.state;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span> Client</span></div><div class="line"><span class="comment"> * <span class="doctag">@Author</span> littlehui</span></div><div class="line"><span class="comment"> * <span class="doctag">@Date</span> 2020/4/7 17:18</span></div><div class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></div><div class="line"><span class="comment"> **/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Car car = <span class="keyword">new</span> Car();</div><div class="line">        CarStart carStart = <span class="keyword">new</span> CarStart();</div><div class="line">        carStart.doCarAction(car);</div><div class="line">        CarRun carRun = <span class="keyword">new</span> CarRun();</div><div class="line">        carRun.doCarAction(car);</div><div class="line">        CarStop carStop = <span class="keyword">new</span> CarStop();</div><div class="line">        carStop.doCarAction(car);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>执行结果</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Connected to the target VM, address: &apos;127.0.0.1:64995&apos;, transport: &apos;socket&apos;</div><div class="line">汽车启动中。</div><div class="line">汽车在行驶中。</div><div class="line">汽车停止。</div><div class="line">Disconnected from the target VM, address: &apos;127.0.0.1:64995&apos;, transport: &apos;socket&apos;</div></pre></td></tr></table></figure><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><p>好处<br>状态控制放到了服务的内部，客户端不用操作具体的状态流转业务逻辑。可以分节点操作，扩展性能比较好。<br>上面这个例子只是很简单的模仿了一下工作流控制状态的跳转。状态模式最主要的好处就是把状态的判断与控制放到了其服务端的内部，使得客户端不需要去写很多代码判断，来控制自己的节点跳转，而且这样实现的话，我们可以把每个节点都分开来处理，当流程流转到某个节点的时候，可以去写自己的节点流转方法。</p></li><li><p>坏处<br>状态类要同时实现。耦合度会高。</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;状态模式是将对象的状态接口抽出，从状态的维度出发描述对象。对象千千万，状态&lt;br&gt;就那么几个，所以从状态的维度度量
      
    
    </summary>
    
      <category term="java" scheme="http://www.lilhui.com/categories/java/"/>
    
      <category term="设计模式" scheme="http://www.lilhui.com/categories/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="状态模式" scheme="http://www.lilhui.com/tags/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
